/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");sap.ca.scfld.md.controller.BaseDetailController.extend("fcg.grc.accessrequest.approve.view.RoleDetails",{oModel:null,mRoleId:0,mRoleType:"",mRoleSystem:"",mRequestNumber:"",mValidTo:null,mValidFrom:null,mAccessType:"",gRecentRoleId:{},glocale:sap.ui.getCore().getConfiguration().getLanguage(),resBundle:null,onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="roleDetails"){var l=e.getParameter("arguments").contextPath;var a=e.getParameter("arguments").key;var m=this.getView().getModel();var R=m.oData[a].AccessID;var b=m.oData[a].RoleType;var c=m.oData[a].System;var V=m.oData[a].ValidTo;var d=m.oData[a].ValidFrom;var f=m.oData[l].RequestNumber;var A=m.oData[a].AccessType;var r=this.getView().byId("itfRisks");var g=this.getView().byId("itfActions");if(A==="FFI"){r.setVisible(false);g.setVisible(false);}else{r.setVisible(true);g.setVisible(true);}var h={'RoleID':R,'RoleType':b,'RoleSystem':c,'RequestNumber':f,'ValidTo':V,'ValidFrom':d,'AccessType':A};this.refreshRoleDetail(h);}},this);},onBackBtnPressed:function(e){window.history.go(-1);},getResBundle:function(){if(this.resBundle===null){this.resBundle=this.getView().getModel("i18n").getResourceBundle();}return this.resBundle;},getModel:function(){return this.getView().getModel();},getSelectedRoles:function(m){var d=m.getProperty("/SelectedRoles");if(!d){d=new Array();m.setProperty("/SelectedRoles",d);}return d;},isVisible:function(p){if(p&&p!=null&&p!=""){return true;}return false;},requestCompletedRole:function(c){var d={};var C=this.byId("INFO_FORM").getContent();for(var i=0;i<C.length;i++){var o=C[i];var k=o.getId();if(o.getMetadata()._sClassName==='sap.m.Text'){k=k.replace("_txt","_lbl");d[k]=o.getText();o.setVisible(this.isVisible(o.getText()));}}for(var i=0;i<C.length;i++){var o=C[i];var k=o.getId();if(o.getMetadata()._sClassName==='sap.m.Label'){o.setVisible(this.isVisible(d[k]));}}this.byId("roleDescription").setVisible(this.isVisible(this.byId("longDescription").getText()));this.byId("actionList").setVisible((this.byId("actionList").getItems().length===0)?false:true);c.getView().setBusy(false);},getRoleKey:function(){return"System='"+this.mRoleSystem+"',RequestNumber='"+this.mRequestNumber+"',RoleType='"+this.mRoleType+"',RoleID='"+this.mRoleId+"',AccessType='"+this.mAccessType+"'";},refreshRoleDetail:function(d){if(d&&d.RoleID){if(this.gRecentRoleId[d.RoleID]===undefined){this.gRecentRoleId[d.RoleID]="X";}this.getView().setBusy(true);var m=this.getModel();m.attachRequestCompleted(function(){this.requestCompletedRole(this);},this);this.mRoleId=d.RoleID;this.mRoleType=d.RoleType;this.mRoleSystem=d.RoleSystem;this.mRequestNumber=d.RequestNumber;this.mValidTo=d.ValidTo;this.mValidFrom=d.ValidFrom;this.mAccessType=d.AccessType;this.getView().bindElement("/Roles("+this.getRoleKey()+")",{expand:"Actions,Risks"});this.getView().setBusy(false);}},formatValidityDate:function(V,D){var v=this.mValidTo;if(v!=null&&v!=""&&typeof v==="string"){v=new Date(this.mValidTo);}if(v===null||v===""||v.getFullYear()===9999){v=D;}else{v=v.toUTCString();}return v;},formatValidityFromDate:function(V,D){var v=V;if(v!=null&&v!=""&&typeof v==="string"){v=new Date(V);}if(v===null||v===""||v.getFullYear()===9999){v=D;}else{v=v.toUTCString();}return v;},formatAccessType:function(p){if(p){return this.getResBundle().getText("ACCESS_TYPE_TEXT",[p]);}}});
