sap.ui.define(["cl/conchaytoro/zpp_elaboracion_mezcla/controller/BaseController","sap/ui/model/json/JSONModel","cl/conchaytoro/zpp_elaboracion_mezcla/model/formatter","sap/m/MessageBox"],function(e,t,i,n){"use strict";return e.extend("cl.conchaytoro.zpp_elaboracion_mezcla.controller.Detail",{formatter:i,onInit:function(){var e=new t({busy:false,delay:0});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this))},onShareEmailPress:function(){var e=this.getModel("detailView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("BuscarSet",{Plnum:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var i=t.getPath(),n=this.getResourceBundle(),o=e.getModel().getObject(i),a=o.Plnum,r=o.Psttr,s=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(i);s.setProperty("/shareSendEmailSubject",n.getText("shareSendEmailObjectSubject",[a]));s.setProperty("/shareSendEmailMessage",n.getText("shareSendEmailObjectMessage",[r,a,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView");t.setProperty("/delay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},_selectFirst:function(){sap.ui.getCore().byId("application-ZOBJ_SEM_ELAB_MEZCLA-display-component---master--list").getItems()[0].firePress()},onAprobar:function(){var e=this;var t=sap.ui.getCore().byId("application-ZOBJ_SEM_ELAB_MEZCLA-display-component---master--list");var i=t.getSelectedItem().getProperty("number");var o=e.getOwnerComponent().getModel();n.show("Â¿Realmente desea Aprobar Simulación NÂ° "+i+""+"?\n",{icon:n.Icon.QUESTION,title:"Aprobar Simulación",actions:[n.Action.OK,n.Action.CLOSE],onClose:function(n){if(n==="OK"){var a={IPlannedOrder:i};sap.ui.core.BusyIndicator.show();o.create("/CreaProcesoSet",a,{success:function(i){sap.ui.core.BusyIndicator.hide();if(i.IPlannedOrder===""){sap.m.MessageBox.warning("El pedido no fue creado",{title:"Advertencia",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}else{sap.m.MessageBox.success("Â¡Simulación NÂ° "+i.IPlannedOrder+"  Aprobada Exitosamente!",{title:"Confirmación",onClose:function(){t.getBinding("items").refresh(true);e.getOwnerComponent().oListSelector.clearMasterListSelection();e.getRouter().navTo("master")},styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error("Error al Aprobar Simulación.",{title:"Error",onClose:function(){t.getBinding("items").refresh(true);e.getOwnerComponent().oListSelector.clearMasterListSelection();e.getRouter().navTo("master")},styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}.bind(this)})}else{}}})}})});