sap.ui.define(["cl/conchaytoro/zpp_notifica_descomposicion/controller/BaseController","sap/ui/model/json/JSONModel","cl/conchaytoro/zpp_notifica_descomposicion/model/formatter","sap/m/MessageBox"],function(e,t,i,n){"use strict";return e.extend("cl.conchaytoro.zpp_notifica_descomposicion.controller.Detail",{formatter:i,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this))},onShareEmailPress:function(){var e=this.getModel("detailView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},onListUpdateFinished:function(e){var t,i=e.getParameter("total"),n=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(i){t=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[i])}else{t=this.getResourceBundle().getText("detailLineItemTableHeading")}n.setProperty("/lineItemListTitle",t)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("NotificaSet",{IAufnr:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var i=t.getPath(),n=this.getResourceBundle(),o=e.getModel().getObject(i),a=o.IAufnr,s=o.IAufnr,r=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(i);r.setProperty("/shareSendEmailSubject",n.getText("shareSendEmailObjectSubject",[a]));r.setProperty("/shareSendEmailMessage",n.getText("shareSendEmailObjectMessage",[s,a,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),i=this.byId("lineItemsList"),n=i.getBusyIndicatorDelay();t.setProperty("/delay",0);t.setProperty("/lineItemTableDelay",0);i.attachEventOnce("updateFinished",function(){t.setProperty("/lineItemTableDelay",n)});t.setProperty("/busy",true);t.setProperty("/delay",e)},onNotificar:function(){var e=this;var t=sap.ui.getCore().byId("application-ZOBJ_SEM_NOTIF_DESCOMP-display-component---master--list");var i=e.getView().byId("orden").getText();var o=e.getOwnerComponent().getModel();n.show("¿Realmente desea Notificar la Orden N° "+i+""+"?\n",{icon:n.Icon.QUESTION,title:"Notificar Descomposición...",actions:[n.Action.OK,n.Action.CLOSE],onClose:function(a){if(a==="OK"){var s={IAufnr:i};sap.ui.core.BusyIndicator.show();o.update("/NotificaSet(IAufnr='"+i+"')",s,{success:function(){sap.ui.core.BusyIndicator.hide();n.success("¡La Orden ha sido Notificada!");t.getBinding("items").refresh(true);e.getOwnerComponent().oListSelector.clearMasterListSelection();e.getRouter().navTo("master")},error:function(t){sap.ui.core.BusyIndicator.hide();n.error("Error al Notificar.");e.getOwnerComponent().oListSelector.clearMasterListSelection();e.getRouter().navTo("master")}})}else{}}})}})});