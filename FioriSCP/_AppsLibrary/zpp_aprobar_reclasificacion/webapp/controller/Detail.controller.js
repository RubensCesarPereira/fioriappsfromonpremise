sap.ui.define(["cl/conchaytoro/zpp_aprobar_reclasificacion/controller/BaseController","sap/ui/model/json/JSONModel","cl/conchaytoro/zpp_aprobar_reclasificacion/model/formatter","sap/m/MessageBox"],function(e,t,a,i){"use strict";return e.extend("cl.conchaytoro.zpp_aprobar_reclasificacion.controller.Detail",{formatter:a,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this))},onShareEmailPress:function(){var e=this.getModel("detailView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},onListUpdateFinished:function(e){var t,a=e.getParameter("total"),i=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(a){t=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[a])}else{t=this.getResourceBundle().getText("detailLineItemTableHeading")}i.setProperty("/lineItemListTitle",t)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("BuscCabeceraSet",{Aufnr:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var a=t.getPath(),i=this.getResourceBundle(),n=e.getModel().getObject(a),r=n.Aufnr,o=n.Aufnr,s=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(a);s.setProperty("/shareSendEmailSubject",i.getText("shareSendEmailObjectSubject",[r]));s.setProperty("/shareSendEmailMessage",i.getText("shareSendEmailObjectMessage",[o,r,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),a=this.byId("lineItemsList"),i=a.getBusyIndicatorDelay();t.setProperty("/delay",0);t.setProperty("/lineItemTableDelay",0);a.attachEventOnce("updateFinished",function(){t.setProperty("/lineItemTableDelay",i)});t.setProperty("/busy",true);t.setProperty("/delay",e)},onAutorizar:function(e){var t=this;var a=sap.ui.getCore().byId("application-ZOBJ_SEM_APRO_RECLASIF-display-component---master--list");var n=t.getView().byId("Orden");var r=n.getText();var o=t.getOwnerComponent().getModel();i.show("¿Realmente desea Aprobar la Orden N° "+r+""+"?\n",{icon:i.Icon.QUESTION,title:"Aprobar Orden Reclasificación...",actions:[i.Action.OK,i.Action.CLOSE],onClose:function(e){if(e==="OK"){var n={Aufnr:r};sap.ui.core.BusyIndicator.show();o.update("/BuscCabeceraSet(Aufnr='"+r+"')",n,{success:function(){sap.ui.core.BusyIndicator.hide();i.success("¡La Orden ha sido Aprobada!");a.getBinding("items").refresh(true);t.getOwnerComponent().oListSelector.clearMasterListSelection();t.getRouter().navTo("master")},error:function(e){sap.ui.core.BusyIndicator.hide();var a=JSON.parse(JSON.parse(JSON.stringify(e)).responseText).error.message.value;i.error(a);t.getOwnerComponent().oListSelector.clearMasterListSelection();t.getRouter().navTo("master")}})}else{}}})},onRechazar:function(e){var t=this;var a=sap.ui.getCore().byId("application-ZOBJ_SEM_APRO_RECLASIF-display-component---master--list");var n=t.getView().byId("Orden");var r=n.getText();var o=t.getOwnerComponent().getModel();i.show("¿Realmente desea Rechazar la Orden N° "+r+""+"?\n",{icon:i.Icon.QUESTION,title:"Rechazar Orden Reclasificación...",actions:[i.Action.OK,i.Action.CLOSE],onClose:function(e){if(e==="OK"){var n={Aufnr:r};sap.ui.core.BusyIndicator.show();o.update("/RechazarSet(Aufnr='"+r+"')",n,{success:function(){sap.ui.core.BusyIndicator.hide();i.success("¡La Orden ha sido Rechazada!");a.getBinding("items").refresh(true);t.getOwnerComponent().oListSelector.clearMasterListSelection();t.getRouter().navTo("master")},error:function(e){sap.ui.core.BusyIndicator.hide();i.error("¡Error al Rechazar Orden!");t.getOwnerComponent().oListSelector.clearMasterListSelection();t.getRouter().navTo("master")}})}else{}}})}})});