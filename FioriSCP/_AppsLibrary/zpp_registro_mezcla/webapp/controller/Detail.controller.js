sap.ui.define(["cl/conchaytoro/zpp_registro_mezcla/controller/BaseController","sap/ui/model/json/JSONModel","cl/conchaytoro/zpp_registro_mezcla/model/formatter","sap/m/MessageBox"],function(e,t,a,i){"use strict";return e.extend("cl.conchaytoro.zpp_registro_mezcla.controller.Detail",{formatter:a,onInit:function(){var e=new t({busy:false,delay:0});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));this.activeButton();var a={motivo:[{name:"Turno A",value:"Turno A"},{name:"Turno B",value:"Turno B"},{name:"Turno C",value:"Turno C"}]};var i=new t(a);this.getView().setModel(i,"pp")},onShareEmailPress:function(){var e=this.getModel("detailView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("BuscarCabezeraSet",{Aufnr:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var a=t.getPath(),i=this.getResourceBundle(),s=e.getModel().getObject(a),r=s.Aufnr,o=s.Erdat,u=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(a);u.setProperty("/shareSendEmailSubject",i.getText("shareSendEmailObjectSubject",[r]));u.setProperty("/shareSendEmailMessage",i.getText("shareSendEmailObjectMessage",[o,r,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView");t.setProperty("/delay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},_selectFirst:function(){sap.ui.getCore().byId("application-ZOBJ_SEM_REG_MEZCLA-display-component---master--list").getItems()[0].firePress()},clearInput:function(){var e=this.getView().byId("grado");var t=this.getView().byId("num_mezcla");var a=this.getView().byId("enologo");var i=this.getView().byId("bodega");var s=this.getView().byId("turno");var r=this.getView().byId("cosecha");e.setValue("");t.setValue("");a.setValue("");i.setValue("");s.setValue("");r.setValue("");e.setValueState(sap.ui.core.ValueState.None);t.setValueState(sap.ui.core.ValueState.None);a.setValueState(sap.ui.core.ValueState.None);i.setValueState(sap.ui.core.ValueState.None);s.setValueState(sap.ui.core.ValueState.None);r.setValueState(sap.ui.core.ValueState.None)},activeButton:function(){var e=this.getView().byId("msg");var t=this.getView().byId("btnConta");var a=this.getView().byId("grado");var i=this.getView().byId("num_mezcla");var s=this.getView().byId("enologo");var r=this.getView().byId("bodega");var o=this.getView().byId("turno");var u=this.getView().byId("cosecha");if(a.getValue()===""||a.getValueState()!==sap.ui.core.ValueState.Success||i.getValue()===""||i.getValueState()!==sap.ui.core.ValueState.Success||s.getValue()===""||s.getValueState()!==sap.ui.core.ValueState.Success||r.getValue()===""||r.getValueState()!==sap.ui.core.ValueState.Success||o.getSelectedKey()===""||o.getValueState()!==sap.ui.core.ValueState.Success||u.getValue()===""||u.getValueState()!==sap.ui.core.ValueState.Success){t.setEnabled(false);e.setVisible(true)}else{t.setEnabled(true);e.setVisible(false)}},activeMessage:function(){},onConta:function(e){var t=this;var a=sap.ui.getCore().byId("application-ZOBJ_SEM_REG_MEZCLA-display-component---master--list");var i=t.getView().byId("orden");var s=i.getText();var r=t.getView().byId("grado");var o=t.getView().byId("num_mezcla");var u=t.getView().byId("enologo");var n=t.getView().byId("bodega");var l=t.getView().byId("turno");var c=t.getView().byId("cosecha");var d=r.getValue();var g=o.getValue();var V=u.getValue();var h=n.getValue();var S=l.getSelectedKey();var p=c.getValue();var v=t.getOwnerComponent().getModel();var b={ImAction:"",Aufnr:s,IBodega:h,IEnologo:V,IGrado:d,INumMezcla:g,ITurno:S,IAnocosecha:p,IUpdkz:"",EReturn:""};sap.ui.core.BusyIndicator.show();v.create("/CreaProcesoMSet",b,{success:function(e){sap.ui.core.BusyIndicator.hide();if(e.EReturn===""){sap.m.MessageBox.warning("¡La Orden no fue Contabilizada!",{title:"Advertencia",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}else{sap.m.MessageBox.success("¡Orden N° "+e.EReturn+" ha sido Contabilizada!",{title:"Confirmación",onClose:function(){a.getBinding("items").refresh(true);t._selectFirst();t.clearInput()},styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}}.bind(this),error:function(){sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error("Error al Contabilizar",{title:"Error",onClose:function(){a.getBinding("items").refresh(true);t._selectFirst();t.clearInput()},styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}.bind(this)})},handleValidationError2:function(e){e.getSource().setValueState(sap.ui.core.ValueState.Error);this.validaInput()},handleValidationSuccess2:function(e){e.getSource().setValueState(sap.ui.core.ValueState.Success);this.validaInput()},validaInput:function(e){var t=this.getView().byId("grado");var a=this.getView().byId("num_mezcla");var i=this.getView().byId("enologo");var s=this.getView().byId("bodega");var r=this.getView().byId("turno");var o=this.getView().byId("cosecha");var u=t.getValue();var n=a.getValue();var l=i.getValue();var c=s.getValue();var d=r.getSelectedKey();var g=o.getValue();if(u===""){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.Success)}if(n===""){a.setValueState(sap.ui.core.ValueState.Error)}else{a.setValueState(sap.ui.core.ValueState.Success)}if(l===""){i.setValueState(sap.ui.core.ValueState.Error)}else{i.setValueState(sap.ui.core.ValueState.Success)}if(c===""){s.setValueState(sap.ui.core.ValueState.Error)}else{s.setValueState(sap.ui.core.ValueState.Success)}if(d===""){r.setValueState(sap.ui.core.ValueState.Error)}else{r.setValueState(sap.ui.core.ValueState.Success)}if(g===""||!/^\d{4}$/.test(e.getParameter("value"))){o.setValueState(sap.ui.core.ValueState.Error)}else{o.setValueState(sap.ui.core.ValueState.Success)}this.activeButton()}})});