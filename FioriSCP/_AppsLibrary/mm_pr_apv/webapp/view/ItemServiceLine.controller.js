/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.dialog.factory");jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.m.SelectDialog");jQuery.sap.require("sap.ca.ui.quickoverview.EmployeeLaunch");jQuery.sap.require("sap.ca.ui.quickoverview.CompanyLaunch");jQuery.sap.require("ui.s2p.mm.requisition.approve.util.Conversions");sap.ca.scfld.md.controller.BaseDetailController.extend("ui.s2p.mm.requisition.approve.view.ItemServiceLine",{_bIsHeaderBasedApproval:false,onInit:function(){this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel=this.oApplicationFacade.getODataModel();this.oRouter.attachRouteMatched(this._handleRouteMatched,this);this.getView().getModel().setSizeLimit(1000000);if(this.extHookOnInit){this.extHookOnInit();}},_handleRouteMatched:function(e){if(e.getParameter("name")==="subDetail"||e.getParameter("name")==="itemServiceLine"){if(e.getParameter("name")==="itemServiceLine"){this._bIsHeaderBasedApproval=true;}else{this._bIsHeaderBasedApproval=false;}this.sOrigin=e.getParameter("arguments").SAP__Origin;this.sWorkitemID=e.getParameter("arguments").WorkitemID;this.sPrNumber=e.getParameter("arguments").PrNumber;this.sPrItem=e.getParameter("arguments").ItemNumber;this.sServiceItem=e.getParameter("arguments").ServiceLineNumber;var i="/"+this._ServiceLinesCollection();this.getView().setBindingContext(new sap.ui.model.Context(this.getView().getModel(),i));this.setLocalHeaderFooterOptions();}},_ItemCollection:function(){var r;if(this._bIsHeaderBasedApproval===false){r="ItemDetailCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"')";}else{r="HeaderItemDetailCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"',PrNumber='"+this.sPrNumber+"',ItemNumber='"+this.sPrItem+"')";}return r;},_ServiceLinesCollection:function(){var r="ServiceLineCollection(SAP__Origin='"+this.sOrigin+"',PrNumber='"+this.sPrNumber+"',ItemNumber='"+this.sPrItem+"',ServiceLineNumber='"+this.sServiceItem+"')";return r;},setLocalHeaderFooterOptions:function(){var t=this;var i=this._ItemCollection();var s=this._ServiceLinesCollection();var S=this.oDataModel.getProperty("/"+i+"/ServiceLines");if(typeof S==="undefined"){this.navBack();return;}var l=S.length;var c=S.indexOf(s);var I=(this._bIsHeaderBasedApproval===false)?"view.ServiceLineDetail.title":"view.ItemServiceLine.title";var C=null;if(this._bIsHeaderBasedApproval===true){var v=this.oRouter.getView("ui.s2p.mm.requisition.approve.view.ItemDetails");C=v.getController();}var L={onBack:function(){t.navBack();},oUpDownOptions:{iPosition:c,iCount:l,fSetPosition:function(n){if((n>=0)&&(n<l)){var p=S[n];var a=t.oDataModel.getProperty("/"+p).ServiceLineNumber;if(t._bIsHeaderBasedApproval===false){t.oRouter.navTo("subDetail",{SAP__Origin:t.sOrigin,WorkitemID:t.sWorkitemID,PrNumber:t.sPrNumber,ItemNumber:t.sPrItem,ServiceLineNumber:a},true);}else{t.oRouter.navTo("itemServiceLine",{SAP__Origin:t.sOrigin,WorkitemID:t.sWorkitemID,PrNumber:t.sPrNumber,ItemNumber:t.sPrItem,ServiceLineNumber:a},true);}}},sI18NDetailTitle:I,oParent:C}};if(this.extHookSetHeaderFooterOptions){L=this.extHookSetHeaderFooterOptions(L);}this.setHeaderFooterOptions(L);},navBack:function(){if(this.sOrigin!==""&&this.sWorkitemID!==""&&this._bIsHeaderBasedApproval===false){var m="WorkflowTaskCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"')";this.oRouter.navTo("detail",{contextPath:m},true);}else if(this.sOrigin!==""&&this.sWorkitemID!==""&&this.sPrNumber!==""&&this.sPrItem!==""&&this._bIsHeaderBasedApproval===true){this.oRouter.navTo("itemDetails",{SAP__Origin:this.sOrigin,WorkitemID:this.sWorkitemID,PrNumber:this.sPrNumber,ItemNumber:this.sPrItem},true);}}});
