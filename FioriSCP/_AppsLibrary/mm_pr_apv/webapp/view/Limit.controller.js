/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("ui.s2p.mm.requisition.approve.util.Conversions");jQuery.sap.require("sap.ca.scfld.md.ConfigurationBase");jQuery.sap.require("sap.ca.ui.dialog.factory");sap.ca.scfld.md.controller.BaseDetailController.extend("ui.s2p.mm.requisition.approve.view.Limit",{_bIsHeaderBasedApproval:false,onInit:function(){this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel=this.oApplicationFacade.getODataModel();this.oRouter.attachRouteMatched(this._handleRouteMatched,this);this.getView().getModel().setSizeLimit(1000000);if(this.extHookOnInit){this.extHookOnInit();}},_handleRouteMatched:function(e){if(e.getParameter("name")==="Limit"||e.getParameter("name")==="itemServiceLimit"){if(e.getParameter("name")==="itemServiceLimit"){this._bIsHeaderBasedApproval=true;}else{this._bIsHeaderBasedApproval=false;}this.sOrigin=e.getParameter("arguments").SAP__Origin;this.sWorkitemID=e.getParameter("arguments").WorkitemID;this.sPrNumber=e.getParameter("arguments").PrNumber;this.sPrItem=e.getParameter("arguments").ItemNumber;var l="/"+this._LimitCollectionPath();this.getView().setBindingContext(new sap.ui.model.Context(this.getView().getModel(),l));this.setLocalHeaderFooterOptions();}},_HeaderCollectionPath:function(){var r="HeaderDetailCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"')";return r;},_ItemCollectionPath:function(){var r="HeaderItemDetailCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"',PrNumber='"+this.sPrNumber+"',ItemNumber='"+this.sPrItem+"')";return r;},_LimitCollectionPath:function(){var l="LimitCollection("+"SAP__Origin='"+this.sOrigin+"',PrNumber='"+this.sPrNumber+"',ItemNumber='"+this.sPrItem+"')";return l;},setLocalHeaderFooterOptions:function(){var t=this;var c="";var l="";var L="/"+this._LimitCollectionPath();var a=this.oDataModel.getProperty(L);if(typeof a==="undefined"){this.navBack();return;}if(this._bIsHeaderBasedApproval===true){var h=this._HeaderCollectionPath();var i=this._ItemCollectionPath();var I=this.oDataModel.getProperty("/"+h+"/HeaderItemDetails");l=I.length;c=I.indexOf(i);}var o={onBack:function(){t.navBack();},sDetailTitle:this.getDetailTitle(c+1,l)};if(this.extHookSetHeaderFooterOptions){o=this.extHookSetHeaderFooterOptions(o);}this.setHeaderFooterOptions(o);},getDetailTitle:function(c,t){if(this._bIsHeaderBasedApproval===false){return this.resourceBundle.getText("view.LimitDetail.title");}else{return this.resourceBundle.getText("view.ItemServiceLimit.title",[c,t]);}},navBack:function(){if(this.sOrigin!==""&&this.sWorkitemID!==""&&this._bIsHeaderBasedApproval===false){var m="WorkflowTaskCollection(SAP__Origin='"+this.sOrigin+"',WorkitemID='"+this.sWorkitemID+"')";this.oRouter.navTo("detail",{contextPath:m},true);}else if(this.sOrigin!==""&&this.sWorkitemID!==""&&this.sPrNumber!==""&&this.sPrItem!==""&&this._bIsHeaderBasedApproval===true){this.oRouter.navTo("itemDetails",{SAP__Origin:this.sOrigin,WorkitemID:this.sWorkitemID,PrNumber:this.sPrNumber,ItemNumber:this.sPrItem},true);}}});
