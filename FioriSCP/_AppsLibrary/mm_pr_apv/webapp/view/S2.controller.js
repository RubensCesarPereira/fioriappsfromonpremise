/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("ui.s2p.mm.requisition.approve.util.Conversions");sap.ca.scfld.md.controller.ScfldMasterController.extend("ui.s2p.mm.requisition.approve.view.S2",{_IsItemBasedApproval:false,_ItemType:"",onInit:function(){var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);var l=this.getList();this.bIsApproved=false;C.oEventBus.subscribe("ui.s2p.mm.requisition.approve","selectNextWorkItem",this._selectNextWorkItem,this);this.getView().getModel().setSizeLimit(1000000);this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"||e.getParameter("name")==="headerDetail"){this.sItemBindingContextPath=this.getBindingContextPathFor(e.getParameter("arguments"));var n=l.getItems().length;var s=l.getSelectedItem();if(s!==null&&!sap.ui.Device.system.phone){var S=l.indexOfItem(s);this.aNextItems=[];var N=S+1;var i=S+2;this.aNextItems.push(s);if(n>=i){this.aNextItems.push(l.getItems()[N]);this.aNextItems.push(l.getItems()[i]);}else if(n>=N){this.aNextItems.push(l.getItems()[N]);}}}},this);l.attachEvent("updateFinished",function(e){if(!sap.ui.Device.system.phone){if(!this.aNextItems){var l=this.getList();var o=this.findItemByContextPath(this.sItemBindingContextPath);var s=l.getSelectedItem();if(s!==null){var S=l.indexOfItem(s);var n=l.getItems().length;this.aNextItems=[];var N=S+1;var a=S+2;this.aNextItems.push(s);if(n>=a){this.aNextItems.push(l.getItems()[N]);this.aNextItems.push(l.getItems()[a]);}else if(n>=N){this.aNextItems.push(l.getItems()[N]);}}else{l.setSelectedItem(o);s=o;}}else if(this.aNextItems&&this.getList().getItems().length>0){if(!this.getList().getSelectedItem()){var f=false;for(var i in this.aNextItems){if(this.aNextItems[i]==undefined)break;var I=this.findItemByContextPath(this.aNextItems[i].getBindingContextPath());if(I){this.setListItem(I);f=true;break;}}if(!f){this.selectFirstItem();}}}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE");}}},this);if(this.extHookOnInit){this.extHookOnInit();}},_selectNextWorkItem:function(c,e,d){if(e==="selectNextWorkItem"){if(sap.ui.Device.system.phone){window.history.go(-1);}var l=this.getList();l.getBinding('items').refresh();l.attachEventOnce("updateFinished",function(){if(d.bMessageToast&&d.bMessageToast===true&&d.sMessage){sap.ca.ui.message.showMessageToast(d.sMessage);}},this);}},getHeaderFooterOptions:function(){var l={sI18NMasterTitle:"view.Master.title"};if(this.extHookSetHeaderFooterOptions){l=this.extHookSetHeaderFooterOptions(l);}return l;},setApprovalType:function(l){if(l){var b=l.getBindingContext();if(b){var p=this.getView().getModel().getProperty(b.getPath());this._IsItemBasedApproval=p.IsItemBasedApproval;}}},setItemType:function(l){if(l){var b=l.getBindingContext();if(b){var p=this.getView().getModel().getProperty(b.getPath());this._ItemType=p.ItemType;}}},getItemType:function(){return this._ItemType;},_handleSelect:function(e){this.setApprovalType(e.getParameter("listItem"));this.setItemType(e.getParameter("listItem"));sap.ca.scfld.md.controller.ScfldMasterController.prototype._handleSelect.call(this,e);},_handleItemPress:function(e){this.setApprovalType(e.getSource());this.setItemType(e.getSource());sap.ca.scfld.md.controller.ScfldMasterController.prototype._handleItemPress.call(this,e);},selectFirstItem:function(){var l=this.getList();var i=l.getItems();var L;if(i.length<1){return;}L=this._oApplicationImplementation.getFirstListItem(this);if(L){this.setApprovalType(L);this.setListItem(L);}},getDetailRouteName:function(){if(this._IsItemBasedApproval!="X"){return"headerDetail";}else{return"detail";}},_searchOnODataFields:function(i,f){var o=this._getODataSearchFields();var m=i.getBindingContext(this.sModelName).getProperty();return o.some(function(k){var v="";if(k==="WiCreatedAt"){var M=m[k];var a=sap.ca.ui.model.format.DateFormat.getDateInstance({style:"medium"},sap.ui.getCore().getConfiguration().getLocale());if(M!==""){v=a.format(M,false);}}else{v=m[k];}if(typeof v==="string"){if(v.toLowerCase().indexOf(f)!==-1){return true;}}});},_getODataSearchFields:function(){var o=["CreatedByName","ForwardedByName","ItemDescriptions","PrNumber","PrNumberFormatted","SearchForText","SubstitutingForName","WiCreatedAt","WorkitemID"];if(this.extHookModifySearchableODataFieldsForMasterListSearch){o=this.extHookModifySearchableODataFieldsForMasterListSearch(o);}return o;},_getTextsFromUIElementsForSearch:function(i){var u=[];if(i.getIntro())u.push(i.getIntro());if(i.getTitle())u.push(i.getTitle());if(i.getNumber())u.push(i.getNumber());if(i.getNumberUnit())u.push(i.getNumberUnit());if(i.getFirstStatus())u.push(i.getFirstStatus().getText());if(i.getSecondStatus())u.push(i.getSecondStatus().getText());var a=i.getAttributes();for(var j=0;j<a.length;j++){u.push(a[j].getText());}if(this.extHookDefineSearchableUITextsForMasterListSearch){u=this.extHookDefineSearchableUITextsForMasterListSearch(i);}return u;},_searchOnUITexts:function(i,f){var u=this._getTextsFromUIElementsForSearch(i);return u.some(function(a){if(a!=="undefined"&&a!==""){if(a.toLowerCase().indexOf(f)!==-1){return true;}}});},applySearchPatternToListItem:function(i,f){if(f===""){return true;}if(this._searchOnODataFields(i,f)===true){return true;}if(this._searchOnUITexts(i,f)===true){return true;}return false;}});
